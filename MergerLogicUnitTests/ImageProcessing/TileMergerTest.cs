using MergerLogic.Batching;
using MergerLogic.DataTypes;
using MergerLogic.ImageProcessing;
using MergerLogic.Monitoring.Metrics;
using Microsoft.Extensions.Logging;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;

namespace MergerLogicUnitTests.ImageProcessing
{
    [TestClass]
    [TestCategory("unit")]
    [TestCategory("imageProcessing")]
    public class TileMergerTest
    {

        #region mocks

        private MockRepository _mockRepository;

        private TileMerger _testTileMerger;

        #endregion

        [TestInitialize]
        public void BeforeEach()
        {
            this._mockRepository = new MockRepository(MockBehavior.Loose);

            var metricsProviderMock = this._mockRepository.Create<IMetricsProvider>();
            var tileScalerLoggerMock = this._mockRepository.Create<ILogger<TileScaler>>();
            var tileMergerLoggerMock = this._mockRepository.Create<ILogger<TileMerger>>();

            var testTileScaler = new TileScaler(metricsProviderMock.Object, tileScalerLoggerMock.Object);
            var testImageFormatter = new ImageFormatter();

            this._testTileMerger = new TileMerger(testTileScaler, testImageFormatter, tileMergerLoggerMock.Object);
        }

        #region MergeTiles

        public static IEnumerable<object[]> GetMergeTilesTestParameters()
        {
            var targetCoord = new Coord(9, 608, 343);
            var firstTileBase64 = "/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDACAWGBwYFCAcGhwkIiAmMFA0MCwsMGJGSjpQdGZ6eHJmcG6AkLicgIiuim5woNqirr7EztDOfJri8uDI8LjKzsb/2wBDASIkJDAqMF40NF7GhHCExsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsb/wAARCAEAAQADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwC5RRRWBoFFFFABRRRQAUUUUAFFFFABRRRQAtFFFABRRRQA6iiimAUUUUALRRRQAlFFFACUUUUAJRRRQAlFFFMAooopAFFFFIAooooAKKKKACiiigAooooAKKKKAFooooAKKKKACiiimAtFFFAC0UUUAFFFFACUUUUAJRRRQAUUUUAJRRRQAUUUUgCiiigAooooAKKKKACiiigAooooAWiiimAUUUUANooooAWiiigB1FFFABRRRQAUUUUAFFFFACUUUUAFFFFADaKKKACiiikAtFFFMAooopAFFFFMAooooAKKKKACiiigBKKKKACiiigBaKKKAFooooAKKKKACiiigAooooAKKKKAGUUUUAFFFFAC0UUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAC0UUUgCiiimAUUUUAMooooAKKKKAFooooAKKKKACiiigAooooAKKKKACiiigB1FFFACUUUUAJRRRQAUUUUgFooooAKKKKAFooooAKKKKAG0UUUwCiiigAooooAWiiigAooooAKKKKACiiigAooooAWiiigBKKKKACiiikAUUUUALRRRQAUUUUAFFFFACUUUUAFFFFUAUUUUALRRRSAKKKKACiiigAooooAKKKKACiiigBKKKKACiiigAooooAWiiikAtFFFABRRRQAlFFFACUUUUAOoooqgCiiigAooooAKKKKQDaKKKACiiigBaKKKAFooooAKKKKAG0UUUAJRRRQA6iiikA+iiigAooooAZRRRQA2iiigB9FFFUAUUUUAFFFFACUUUUAJRRRSAKKKKACiiigBaKKKACiiigAooooAWiiigBKKKKAEooooAKKKKQBRRRQAtFFFMAooooAWiiigAooooASiiigBKKKKACiiigAooooAWiiigAooooAWiiigBaKKKAEooooAZRRRQAlFFFABRRRQAtFFFADqKKKACiiigBaKKKAEooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigBKKKKAGUUUUANooooAbRRRQBYooooAKKKKAFooooAKKKKACiiigAooooAKKKKACiiigBtFFFABRRRQAlFFFACUUUUANooooAbRRRQA2iiigBKKKKALVFFFABRRRQAtFFFABRRRQAUUUUAFFFFABRRRQAUUUUAJRRRQAUUUUAJRRRQAyiiigCOiiigBtFFFMB1FFFAD6KKKAJaKKKQBRRRQAtFFFABRRRQAUUUUAFFFFABRRRQAlFFFABRRRQAUUUUANooopgMooooAZRRRQAUUUUAPooooAfRRRQA+iiikAUUUUAFFFFABRRRQAUUUUAJRRRQAUUUUAJRRRQAUUUUANooooAZRRRQAlFFFMAooooAdRRRQAUUUUAFFFFAH//2Q==";
            var secondTileBase64 = "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";

            yield return new object[] {
                new Tile[] {
                    new Tile(targetCoord, Convert.FromBase64String(firstTileBase64)),
                    new Tile(targetCoord, Convert.FromBase64String(secondTileBase64))
                }, targetCoord, TileFormat.Jpeg,
                "/9j/4AAQSkZJRgABAQAAAAAAAAD/2wBDACAWGBwYFCAcGhwkIiAmMFA0MCwsMGJGSjpQdGZ6eHJmcG6AkLicgIiuim5woNqirr7EztDOfJri8uDI8LjKzsb/2wBDASIkJDAqMF40NF7GhHCExsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsb/wAARCAEAAQADASIAAhEBAxEB/8QAGgABAQEAAwEAAAAAAAAAAAAAAAECAwQFBv/EADcQAQABAwIDBAYHCQAAAAAAAAABAgMRBCEFEjETQVGBFCI1obHBFSNCkaLR4TJDU2FkcXKC8P/EABcBAQEBAQAAAAAAAAAAAAAAAAABAgP/xAAbEQEBAQACAwAAAAAAAAAAAAAAAQIRMSFBUf/aAAwDAQACEQMRAD8A7gDg6AAAAAAAAAAKAAADQCgACgAgAI+c4r7Ru+Xwh9G87V8K9J1Fd3tuXmxty57seLWbxUry9Bc7PVU56VerL2PN5Ov0PofZ/Wc/Pn7OMYx+b07NyLtim54x3ePe1frMaif+woIpJncOvUHbAc2gAAAAAAAAAFAAAAAUUAFAAABAAePx79x/t8nHwm5OK7Wcfaj5/J6er0VvV8naVVxyZxyz4vDoqjS8Q2n1aLk05nfbo3PM4Zvb2cTvnKcuY2lyzuk0RgHH3eCY8XJNON4ndjAO2A5tAAAAAAAAAAKAoAAyACgA0AAAAAA6nFfZ13y+MO26nFfZ13y+MLOyuHh92Lujp2xNHqz5fo7MTjq8bhd3kvzRPSuPg9mMTDdYZmfBmW8xE90lUR4ormAYaAEFAUAEABQAAAAABAAAAUAFAAAAdTivs675fGHbdfiFqu9o7lu3HNVOMRn+cLOyvnKKporprjGaZid3vW64roprjpVETDyvozWfwfxR+btcMu81ibeP2J90t1iO7mc5+5uado97jjq5KapicdYRXKAw0AAoAAAAAAAAAAAAAAAAAAAAAKAgPm9Bd7LU07bV+r976R8m6ZZ0+hXu6OLTXe109FffMb/3cgOwAw0AAoAAAAAAAAAAANAAgAIAAAgoAAAK+TfWPJ+hP6j8H6t5siWOHhVzeu1P+UfP5PRePXR6Dr+XmmrkmMzEdYmN/i9lqpHYAc2gAAAFAAAAAAAAABQAQAABAABQAAAAAeNr9Dqb2suXLdvNM4xPNHhDnsUXbViim9TNNUbdY+T0XU1l2KL1mmZxFcVR57N516ZsdsBGgAFAQAAAAAAAAAAQAAAAAFAQUAAAEABHl8aqmmrT1U7TE1THueo4r+ms6jl7ajm5em8wsvFSucBVAAAAAEGQAAAUAFAAABkAEABoBBsAAAGAAZABsBoAAAAQAEAQAAAAUAAAAAFABAAQAABAABQFAAFAAABAAQAAAAAFAAABQAUAEABgAEAAABQAaAAABQAQAAAAAAAAAAAAAAAAAEABgAGQAZAB2AAAAUAAAAAAAAAAAGQAAAQAEABkAGQAZABAAdoAAAFAAAAAAAAAAABAAAAQAGAAcYAMgKNAA2ADlAQAAUAAAAAAAAAEAAAAABkBRgAGAAAAbABsAGwEAAAAAAAAEAAABAAAAZABgAEAUAAaAAAAAB//2Q=="
            };
        }

        [TestMethod]
        [TestCategory("MergeTiles")]
        [DynamicData(nameof(GetMergeTilesTestParameters), DynamicDataSourceType.Method)]
        public void MergeTiles(Tile[] testTiles, Coord testTargetCoord, TileFormat testTileFormat, string expectedTileBytesBase64)
        {
            var tileBuilders = testTiles.Select<Tile, CorrespondingTileBuilder>(tile => () => tile).ToList();
            var result = this._testTileMerger.MergeTiles(tileBuilders, testTargetCoord, testTileFormat);

            Assert.IsNotNull(result);
            Assert.AreEqual(expectedTileBytesBase64, Convert.ToBase64String(result));
        }

        #endregion
    }
}
